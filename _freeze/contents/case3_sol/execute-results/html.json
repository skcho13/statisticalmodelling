{
  "hash": "f41fcea64dca5e24fa3ddc90696db36c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Case Study 3\nsubtitle: 'Applied Multiple Regression/Correlation Analysis for the Behavioral Sciences by Jacob Cohen, Patricia Cohen, Stephen G. West, Leona S. Aiken'\ndate: last-modified\nauthor: Sungkyun Cho\nexecute:\n  warning: false\n  freeze: auto\nformat: \n   html:\n    df-print: tibble\n   # monofont: 'FiraCode-Regular'\n---\n\n::: {.cell}\n\n:::\n\n\n## National Education Longitudinal Study of 1988 (NELS:88)\nSource: p.69 in Multiple Regression and Beyond (3e) by Timothy Z. Keith\n\n![](images/nels_path1.png){width=550}\n\n### *연구주제: 학생들의 과제는 성적에 영향을 주는가? 준다면 그 영향력의 크기는 어떠한가?*\n\n데이터 [NELS88 sample.csv](https://www.dropbox.com/s/x232sv7w4zhrikp/nels88_sample.csv?dl=1)\n\n`grades`: 10학년의 성적 평균 in English, Math, Science, Social Studies.  \n`pared`: 부모의 교육 수준 (높은 쪽)  \n`hw_in`, `hw_out`: 10학년 때 학생들이 보고한 숙제하는데 보낸 주당 평균 시간 (in school or out of school)\n\n![](images/nels_table.png){width=500}\n\n::: {.cell}\n\n```{.r .cell-code}\nnels <- read_csv(\"data/nels88_sample_4_11.csv\")\nnels <- nels |> \n    select(grades = ffugrad, pared = bypared, hw_in = f1s36a1, hw_out = f1s36a2, prev = bytests)\nnels\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 300 × 5\n   grades pared hw_in hw_out  prev\n    <dbl> <dbl> <dbl>  <dbl> <dbl>\n 1   4.33     3     1      0  56.4\n 2   8        5     1      2  58.4\n 3   6.5      4     0      2  44.4\n 4   7.33     6     3      2  67.4\n 5   6        2     3      2  50.7\n 6   4        3     1     NA  46.0\n 7   6.5      6     1      7  62.4\n 8   4.33     2     1      2  46.0\n 9   3.5      2     3      1  46.3\n10   6.5      3     7      5  62.4\n# ℹ 290 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n# summarize data\nsummary(nels)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     grades          pared           hw_in           hw_out     \n Min.   :1.333   Min.   :1.000   Min.   :0.000   Min.   :0.000  \n 1st Qu.:4.500   1st Qu.:2.000   1st Qu.:1.000   1st Qu.:1.000  \n Median :5.750   Median :3.000   Median :2.000   Median :2.000  \n Mean   :5.610   Mean   :3.197   Mean   :2.135   Mean   :2.554  \n 3rd Qu.:6.750   3rd Qu.:4.000   3rd Qu.:3.000   3rd Qu.:4.000  \n Max.   :8.000   Max.   :6.000   Max.   :7.000   Max.   :7.000  \n NA's   :20                      NA's   :25      NA's   :24     \n      prev      \n Min.   :29.34  \n 1st Qu.:43.79  \n Median :50.81  \n Mean   :50.86  \n 3rd Qu.:57.06  \n Max.   :69.96  \n NA's   :12     \n```\n\n\n:::\n\n```{.r .cell-code}\n# count values\nnels |> count(pared)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  pared     n\n  <dbl> <int>\n1     1    31\n2     2    47\n3     3   123\n4     4    53\n5     5    23\n6     6    23\n```\n\n\n:::\n\n```{.r .cell-code}\nnels |> count(hw_out)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 9 × 2\n  hw_out     n\n   <dbl> <int>\n1      0    17\n2      1    75\n3      2    78\n4      3    31\n5      4    33\n6      5    17\n7      6    11\n8      7    14\n9     NA    24\n```\n\n\n:::\n:::\n\n### **변수들 간의 관계 탐색**\n\n::: {.cell layout=\"[50, 40, 10]\"}\n\n```{.r .cell-code}\nlowerCor(nels)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       grads pared hw_in hw_ot prev\ngrades 1.00                        \npared  0.39  1.00                  \nhw_in  0.15  0.02  1.00            \nhw_out 0.37  0.27  0.28  1.00      \nprev   0.51  0.50  0.18  0.30  1.00\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(corrgram)\nnels |> \n  corrgram(upper.panel = panel.cor, lower.panel = panel.pie)\n```\n\n::: {.cell-output-display}\n![](case3_sol_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.callout-note collapse=\"true\"}\n#### code for ggpairs\n\n::: {.cell}\n\n```{.r .cell-code}\ntrendlines <- function(data, mapping, ...){\n    ggplot(data = data, mapping = mapping) + \n        geom_point(alpha = .2) + \n        geom_smooth(method = loess, se = FALSE, color = \"orange\", ...) +\n        geom_smooth(method = lm, se = FALSE, color = \"deepskyblue\", ...)\n}\n\nggpairs2 <- function(data, ...) {\n    GGally::ggpairs(data, lower = list(continuous = trendlines))\n}\n```\n:::\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpairs2(nels)\n```\n\n::: {.cell-output-display}\n![](case3_sol_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n### **세 개의 독립변수로 예측**\n#### *B1. 인과모형 A: 부분 회귀 계수들*\n\n::: {layout-ncol=2} \n![](images/nels_path2-1.png){width=300}\n\n![](images/nels_path3-1.png){width=460}\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod1 <- lm(grades ~ pared + hw_in + hw_out, data = nels)\nsummary(mod1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = grades ~ pared + hw_in + hw_out, data = nels)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.5760 -0.9737  0.1006  0.9497  2.8618 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  3.76892    0.24369  15.466  < 2e-16 ***\npared        0.36326    0.06365   5.707 3.13e-08 ***\nhw_in        0.05066    0.05014   1.010    0.313    \nhw_out       0.22884    0.04752   4.816 2.49e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.299 on 260 degrees of freedom\n  (36 observations deleted due to missingness)\nMultiple R-squared:  0.2377,\tAdjusted R-squared:  0.2289 \nF-statistic: 27.02 on 3 and 260 DF,  p-value: 3.032e-15\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmod2 <- lm(hw_out ~ pared, data = nels)\nsummary(mod2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = hw_out ~ pared, data = nels)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-2.8260 -1.4548 -0.4548  1.1740  5.2874 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  1.34143    0.28227   4.752 3.25e-06 ***\npared        0.37114    0.08016   4.630 5.66e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.746 on 274 degrees of freedom\n  (24 observations deleted due to missingness)\nMultiple R-squared:  0.07255,\tAdjusted R-squared:  0.06917 \nF-statistic: 21.44 on 1 and 274 DF,  p-value: 5.658e-06\n```\n\n\n:::\n:::\n\n#### *D: 표준화 계수 및 부분 상관 계수*\n\n::: {.cell}\n\n```{.r .cell-code}\n# beta: standardized coefficients\nlm.beta::lm.beta(mod1) |> print()  # 범주형 변수가 있을 때는 사용하지 말것!\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = grades ~ pared + hw_in + hw_out, data = nels)\n\nStandardized Coefficients::\n(Intercept)       pared       hw_in      hw_out \n         NA  0.31961944  0.05707121  0.28071933 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsumm(mod1, part.corr=TRUE, model.info=FALSE, model.fit=FALSE) |> print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard errors: OLS\n--------------------------------------------------------------------\n                    Est.   S.E.   t val.      p   partial.r   part.r\n----------------- ------ ------ -------- ------ ----------- --------\n(Intercept)         3.77   0.24    15.47   0.00                     \npared               0.36   0.06     5.71   0.00        0.33     0.31\nhw_in               0.05   0.05     1.01   0.31        0.06     0.05\nhw_out              0.23   0.05     4.82   0.00        0.29     0.26\n--------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n#### *E: 간접효과의 크기와 검증*\n\n![](images/nels_mediate.png){width=400}\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(mediate(grades ~ pared + (hw_out), data = nels))\n```\n\n::: {.cell-output-display}\n![](case3_sol_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: mediate(y = grades ~ pared + (hw_out), data = nels)\n\nDirect effect estimates (traditional regression)    (c') X + M on Y \n          grades   se     t  df     Prob\nIntercept   3.90 0.21 18.39 297 6.04e-51\npared       0.35 0.06  5.66 297 3.61e-08\nhw_out      0.24 0.04  5.33 297 1.90e-07\n\nR = 0.47 R2 = 0.22   F = 41.42 on 2 and 297 DF   p-value:  1.36e-16 \n\n Total effect estimates (c) (X on Y) \n          grades   se     t  df     Prob\nIntercept   4.22 0.21 19.85 298 1.78e-56\npared       0.43 0.06  7.06 298 1.20e-11\n\n 'a'  effect estimates (X on M) \n          hw_out   se    t  df     Prob\nIntercept   1.36 0.27 5.10 298 6.09e-07\npared       0.37 0.08 4.85 298 2.00e-06\n\n 'b'  effect estimates (M on Y controlling for X) \n       grades   se    t  df    Prob\nhw_out   0.24 0.04 5.33 297 1.9e-07\n\n 'ab'  effect estimates (through all  mediators)\n      grades boot   sd lower upper\npared   0.09 0.09 0.03  0.04  0.14\n```\n\n\n:::\n:::\n\n\n### **변수의 추가: 4개의 독립변수로 예측**\n#### *B2. 인과모형 B: 부분 회귀 계수들*\n\n![](images/nels_path4.png){width=400}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod3 <- lm(grades ~ pared + hw_out, data = nels)\nmod4 <- lm(grades ~ pared + hw_out + prev, data = nels)\n```\n:::\n\n\n#### *F: 모형의 비교*\n\n::: {.cell}\n\n```{.r .cell-code}\nexport_summs(mod3, mod4, error_format = \"({p.value})\") |> print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              ────────────────────────────────────────────────────\n                                    Model 1          Model 2      \n                               ───────────────────────────────────\n                (Intercept)            3.80 ***         0.94 *    \n                                      (0.00)           (0.05)     \n                pared                  0.37 ***         0.20 **   \n                                      (0.00)           (0.00)     \n                hw_out                 0.24 ***         0.17 ***  \n                                      (0.00)           (0.00)     \n                prev                                    0.07 ***  \n                                                       (0.00)     \n                               ───────────────────────────────────\n                N                    270              258         \n                R2                     0.23             0.35      \n              ────────────────────────────────────────────────────\n                *** p < 0.001; ** p < 0.01; * p < 0.05.           \n\nColumn names: names, Model 1, Model 2\n```\n\n\n:::\n:::\n\n\n\n\n#### *G: 표준화 계수 및 부분 상관 계수*\n\n::: {.cell}\n\n```{.r .cell-code}\n# beta: standardized coefficients\nlm.beta::lm.beta(mod4) |> print() # 범주형 변수가 있을 때는 사용하지 말것!\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = grades ~ pared + hw_out + prev, data = nels)\n\nStandardized Coefficients::\n(Intercept)       pared      hw_out        prev \n         NA   0.1723538   0.2039104   0.3867412 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsumm(mod4, part.corr=TRUE, model.info=FALSE, model.fit=FALSE) |> print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStandard errors: OLS\n--------------------------------------------------------------------\n                    Est.   S.E.   t val.      p   partial.r   part.r\n----------------- ------ ------ -------- ------ ----------- --------\n(Intercept)         0.94   0.48     1.97   0.05                     \npared               0.20   0.07     2.96   0.00        0.18     0.15\nhw_out              0.17   0.05     3.81   0.00        0.23     0.19\nprev                0.07   0.01     6.61   0.00        0.38     0.33\n--------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n### **추가 분석**\n#### *H: Howework에 영향을 주는 요소들 분석*\n\n![](images/nels_path5.png){width=400}\n\n::: {.cell}\n\n```{.r .cell-code}\nmod5 <- lm(hw_out ~ pared, data = nels)\nmod6 <- lm(hw_out ~ pared + prev, data = nels)\n\nexport_summs(mod5, mod6, error_format = \"({p.value})\") |> print()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              ────────────────────────────────────────────────────\n                                    Model 1          Model 2      \n                               ───────────────────────────────────\n                (Intercept)            1.34 ***         -0.51     \n                                      (0.00)            (0.43)    \n                pared                  0.37 ***          0.25 **  \n                                      (0.00)            (0.01)    \n                prev                                     0.04 **  \n                                                        (0.00)    \n                               ───────────────────────────────────\n                N                    276               264        \n                R2                     0.07              0.12     \n              ────────────────────────────────────────────────────\n                *** p < 0.001; ** p < 0.01; * p < 0.05.           \n\nColumn names: names, Model 1, Model 2\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(mediate(hw_out ~ pared + (prev), data = nels))\n```\n\n::: {.cell-output-display}\n![](case3_sol_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall: mediate(y = hw_out ~ pared + (prev), data = nels)\n\nDirect effect estimates (traditional regression)    (c') X + M on Y \n          hw_out   se     t  df    Prob\nIntercept  -0.25 0.58 -0.43 297 0.66600\npared       0.24 0.09  2.72 297 0.00694\nprev        0.04 0.01  3.11 297 0.00202\n\nR = 0.32 R2 = 0.1   F = 16.95 on 2 and 297 DF   p-value:  1.07e-07 \n\n Total effect estimates (c) (X on Y) \n          hw_out   se    t  df     Prob\nIntercept   1.36 0.27 5.10 298 6.09e-07\npared       0.37 0.08 4.85 298 2.00e-06\n\n 'a'  effect estimates (X on M) \n           prev   se     t  df      Prob\nIntercept 40.05 1.18 33.95 298 2.01e-104\npared      3.38 0.34  9.90 298  3.75e-20\n\n 'b'  effect estimates (M on Y controlling for X) \n     hw_out   se    t  df    Prob\nprev   0.04 0.01 3.11 297 0.00202\n\n 'ab'  effect estimates (through all  mediators)\n      hw_out boot   sd lower upper\npared   0.14 0.14 0.05  0.05  0.23\n```\n\n\n:::\n:::\n\n\n위의 결과는 다음과 같은 경로분석 프레임에서 동시에 구현할 수 있으나,  \n회귀계수의 변화를 확인하거나 부분상관계수 등을 파악해 디테일한 (탐색적인) 분석을 위해서는 위에서처럼 직접 살펴보는 것이 도움이 됨.\n\n### SEM (Structural Equation Modeling)의 예시\n\nSource: *p. 339, p. 421 in Multiple Regression and Beyond (3e) by Timothy Z. Keith*\n\n![](images/SEM-NELS-1.png){width=700}\n\n![](images/SEM-NELS-2.png){width=700}\n",
    "supporting": [
      "case3_sol_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}